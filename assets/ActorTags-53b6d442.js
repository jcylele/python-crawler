import{N as S,V as N}from"./vue-draggable-next.esm-bundler-af6c37bf.js";import{j as C,A as y,G as D,H as V,I as F,_ as z,o as r,c as _,w as i,r as s,b as n,d as h,t as b,e as p,m as P,J as I,k as B,f as v,g as x,F as w}from"./index-172ad7fb.js";class R{}const j={name:"ActorTagEditor",props:{tag_edit_info:R},emits:["delete"],methods:{...C(y,{removeActorTag:"remove",updateActorTag:"update"}),startEdit(){this.tag_edit_info.is_editing=!0},stopEdit(){this.tag_edit_info.is_editing=!1},async onSave(){const[t,e]=await D(this.tag_edit_info.tag);t&&this.stopEdit()},async onReset(){const[t,e]=await V(this.tag_edit_info.tag.tag_id);t&&(this.tag_edit_info.tag=e,this.updateActorTag(e),this.stopEdit())},async onDelete(){const t=this.tag_edit_info.tag.tag_id,[e,a]=await F(t);e&&(this.removeActorTag(t),this.$emit("delete",t))}},async mounted(){}};function G(t,e,a,g,f,o){const l=s("el-text"),d=s("el-input"),u=s("svg-icon"),c=s("el-space"),m=s("el-card");return r(),_(m,{class:"box-card"},{default:i(()=>[n(c,{direction:"vertical",border:""},{default:i(()=>[a.tag_edit_info.is_editing?p("",!0):(r(),_(l,{key:0,class:"mx-1"},{default:i(()=>[h(b(a.tag_edit_info.tag.tag_name),1)]),_:1})),a.tag_edit_info.is_editing?(r(),_(d,{key:1,modelValue:a.tag_edit_info.tag.tag_name,"onUpdate:modelValue":e[0]||(e[0]=T=>a.tag_edit_info.tag.tag_name=T)},null,8,["modelValue"])):p("",!0),n(l,{class:"mx-1"},{default:i(()=>[h("("+b(a.tag_edit_info.tag.used_count)+" actors)",1)]),_:1}),a.tag_edit_info.is_editing?p("",!0):(r(),_(c,{key:2,direction:"horizontal",alignment:"center"},{default:i(()=>[n(u,{size:"24px",name:"edit",onClick:o.startEdit},null,8,["onClick"])]),_:1})),a.tag_edit_info.is_editing?(r(),_(c,{key:3,size:"large",direction:"horizontal",alignment:"center"},{default:i(()=>[n(u,{size:"24px",name:"check",onClick:o.onSave},null,8,["onClick"]),n(u,{size:"24px",name:"refresh",onClick:o.onReset},null,8,["onClick"]),n(u,{size:"24px",name:"remove",onClick:o.onDelete},null,8,["onClick"])]),_:1})):p("",!0)]),_:1})]),_:1})}const H=z(j,[["render",G]]);class J{constructor(e,a){this.tag_id=e,this.tag_priority=a}}class L{constructor(){this.tag_priorities=[]}push(e,a){this.tag_priorities.push(new J(e,a))}length(){return this.tag_priorities.length}}const M={name:"ActorTags",components:{NewActorTag:S,ActorTagEditor:H,draggable:N},data(){return{editing_tags:[]}},computed:{...P(y,{actor_tag_list:"sorted_list"})},methods:{...C(y,{getTagsFromServer:"getFromServer"}),onDeleteActorTag(t){for(const e of this.editing_tags)for(let a=0;a<e.length;a++)if(e[a].tag.tag_id==t){e.splice(a,1);return}},async onSubmitPriority(){let t=new L;for(let g=0;g<10;g++){const f=this.editing_tags[g];for(let o=0;o<f.length;o++){const l=f[o].tag,d=(10-g)*100-o-1;l.tag_priority!=d&&t.push(l.tag_id,d)}}if(t.length()==0)return;let[e,a]=await I(t);e&&B("priorities of tags saved")},async onCancel(){await this.refreshTags()},initTags(){this.editing_tags=[];for(let t=0;t<10;t++)this.editing_tags.push([]);for(const t of this.actor_tag_list){const e=Math.floor(t.tag_priority/100);this.editing_tags[e].push({tag:t,is_editing:!1})}this.editing_tags.reverse()},async refreshTags(){await this.getTagsFromServer(),this.initTags()}},async mounted(){await this.refreshTags()}};function U(t,e,a,g,f,o){const l=s("NewActorTag"),d=s("ActorTagEditor"),u=s("draggable"),c=s("el-space"),m=s("el-button"),T=s("el-main"),E=s("el-container");return r(),_(E,null,{default:i(()=>[n(T,null,{default:i(()=>[n(c,{direction:"vertical",fill:!0},{default:i(()=>[n(l,{onTag_added:o.refreshTags},null,8,["onTag_added"]),n(c,{direction:"vertical"},{default:i(()=>[(r(!0),v(w,null,x(f.editing_tags,k=>(r(),_(c,{direction:"horizontal",style:{border:"1px solid","border-radius":"4px",padding:"2px"},wrap:!0,alignment:"stretch"},{default:i(()=>[n(u,{list:k,group:{name:"tags",pull:!0,put:!0},class:"card_row"},{default:i(()=>[(r(!0),v(w,null,x(k,A=>(r(),_(d,{tag_edit_info:A,key:A.tag.tag_id,onDelete:o.onDeleteActorTag,class:"card"},null,8,["tag_edit_info","onDelete"]))),128))]),_:2},1032,["list"])]),_:2},1024))),256))]),_:1}),n(c,{direction:"horizontal"},{default:i(()=>[n(m,{type:"primary",size:"large",onClick:o.onSubmitPriority},{default:i(()=>[h(" Save ")]),_:1},8,["onClick"]),n(m,{type:"warning",size:"large",onClick:o.onCancel},{default:i(()=>[h(" Reset ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})}const O=z(M,[["render",U],["__scopeId","data-v-bbbbcadd"]]);export{O as default};
