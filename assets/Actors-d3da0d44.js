import{A as j,a as at,o as nt,c as lt,C as rt,b as it,d as Q,g as st,D as ct,e as _t,f as dt,h as ut,l as mt,i as gt}from"./DownloadLimit-8bd67856.js";import{N as Y,V as ht}from"./vue-draggable-next.esm-bundler-eff8011a.js";import{m as L,A as E,a as R,_ as U,o as s,c as d,w as o,r,b as a,d as _,e as V,f as A,g as x,F as v,t as z,n as G,E as ft,h as O,l as q,i as Z,j as P,k as H,p as I,q as $,s as pt}from"./index-2b6b099b.js";import{S as kt,a as tt,A as wt}from"./Consts-b58d017b.js";import{D as yt,d as Ct}from"./DownloadCtrl-f6ac3cc0.js";import{A as M,L as bt}from"./Enums-e33e938b.js";const Vt={name:"ActorFilter",props:{filter_condition:j},emits:["change"],components:{NewActorTag:Y},data(){return{is_category_all:!1,filter_history:[]}},computed:{...L(E,{actor_tag_list:"sorted_list"}),...L(R,{actor_group_list:"sorted_list"}),sort_option_list(){return kt}},watch:{async is_category_all(e,t){e&&this.fillAllCategory(),this.filter_condition.checkAllCategory(e)}},methods:{checkNoTag(e){this.filter_condition.checkNoTag(e)},onCheckedTagChange(){this.filter_condition.onCheckedTagChange()},onCheckedCategoryChange(e){},async onFilterChange(){this.filter_history.push(this.filter_condition.clone()),this.$emit("change")},onFilterCancel(){this.filter_condition.reset()},async toPreviousFilter(){this.filter_history.length>0&&this.filter_condition.copy(this.filter_history.pop())},fillAllCategory(){this.filter_condition.setAllCategoryList(this.actor_group_list.map(e=>e.group_id))}},mounted(){}};function At(e,t,l,w,c,n){const u=r("el-checkbox"),h=r("el-divider"),y=r("el-button"),p=r("el-space"),f=r("el-checkbox-button"),C=r("el-checkbox-group"),S=r("el-switch"),k=r("el-form-item"),b=r("el-option"),F=r("el-select"),g=r("el-rate"),T=r("el-text"),D=r("el-input"),N=r("el-form");return s(),d(p,{direction:"vertical",fill:!0},{default:o(()=>[a(p,{direction:"horizontal",alignment:"flex-start"},{default:o(()=>[a(u,{modelValue:l.filter_condition.show_category,"onUpdate:modelValue":t[0]||(t[0]=i=>l.filter_condition.show_category=i)},{default:o(()=>[_("Category")]),_:1},8,["modelValue"]),a(u,{modelValue:l.filter_condition.show_tag,"onUpdate:modelValue":t[1]||(t[1]=i=>l.filter_condition.show_tag=i)},{default:o(()=>[_("Tag")]),_:1},8,["modelValue"]),a(u,{modelValue:l.filter_condition.show_score,"onUpdate:modelValue":t[2]||(t[2]=i=>l.filter_condition.show_score=i)},{default:o(()=>[_("Star")]),_:1},8,["modelValue"]),a(u,{modelValue:l.filter_condition.show_name,"onUpdate:modelValue":t[3]||(t[3]=i=>l.filter_condition.show_name=i)},{default:o(()=>[_("Name")]),_:1},8,["modelValue"]),a(u,{modelValue:l.filter_condition.show_remark,"onUpdate:modelValue":t[4]||(t[4]=i=>l.filter_condition.show_remark=i)},{default:o(()=>[_("Remark")]),_:1},8,["modelValue"]),a(u,{modelValue:l.filter_condition.show_sort,"onUpdate:modelValue":t[5]||(t[5]=i=>l.filter_condition.show_sort=i)},{default:o(()=>[_("Sort")]),_:1},8,["modelValue"]),a(h,{direction:"vertical"}),a(y,{type:"primary",onClick:n.onFilterChange},{default:o(()=>[_("Search")]),_:1},8,["onClick"]),a(y,{onClick:n.onFilterCancel},{default:o(()=>[_("Reset")]),_:1},8,["onClick"]),c.filter_history.length>0?(s(),d(y,{key:0,type:"success",onClick:n.toPreviousFilter},{default:o(()=>[_("Previous")]),_:1},8,["onClick"])):V("",!0)]),_:1}),a(N,{model:l.filter_condition,"label-width":"100px","label-position":"left"},{default:o(()=>[l.filter_condition.show_category?(s(),d(k,{key:0,label:"Category"},{default:o(()=>[a(C,{modelValue:l.filter_condition.category_list,"onUpdate:modelValue":t[6]||(t[6]=i=>l.filter_condition.category_list=i),onChange:n.onCheckedCategoryChange},{default:o(()=>[(s(!0),A(v,null,x(e.actor_group_list,i=>(s(),d(f,{label:i.group_id},{default:o(()=>[_(z(i.group_name),1)]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue","onChange"]),a(S,{modelValue:c.is_category_all,"onUpdate:modelValue":t[7]||(t[7]=i=>c.is_category_all=i),size:"large","active-text":"All","inactive-text":"None",style:{"margin-left":"10px"}},null,8,["modelValue"])]),_:1})):V("",!0),l.filter_condition.show_tag?(s(),d(k,{key:1,label:"Tags"},{default:o(()=>[a(F,{modelValue:l.filter_condition.tag_list,"onUpdate:modelValue":t[8]||(t[8]=i=>l.filter_condition.tag_list=i),onChange:n.onCheckedTagChange,multiple:"",filterable:"",clearable:""},{default:o(()=>[(s(!0),A(v,null,x(e.actor_tag_list,i=>(s(),d(b,{key:i.tag_id,label:i.tag_name,value:i.tag_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),a(u,{modelValue:l.filter_condition.no_tag,"onUpdate:modelValue":t[9]||(t[9]=i=>l.filter_condition.no_tag=i),onChange:n.checkNoTag,style:{"margin-left":"10px","font-size":"24px"},size:"large",border:""},{default:o(()=>[_(" No Tag ")]),_:1},8,["modelValue","onChange"])]),_:1})):V("",!0),l.filter_condition.show_score?(s(),d(k,{key:2,label:"Star"},{default:o(()=>[a(g,{modelValue:l.filter_condition.show_min_score,"onUpdate:modelValue":t[10]||(t[10]=i=>l.filter_condition.show_min_score=i),"allow-half":""},null,8,["modelValue"]),a(T,null,{default:o(()=>[_("~")]),_:1}),a(g,{modelValue:l.filter_condition.show_max_score,"onUpdate:modelValue":t[11]||(t[11]=i=>l.filter_condition.show_max_score=i),"allow-half":""},null,8,["modelValue"])]),_:1})):V("",!0),l.filter_condition.show_name?(s(),d(k,{key:3,label:"Name"},{default:o(()=>[a(D,{modelValue:l.filter_condition.name,"onUpdate:modelValue":t[12]||(t[12]=i=>l.filter_condition.name=i),style:{width:"200px","font-size":"24px","margin-right":"20px"},clearable:""},null,8,["modelValue"])]),_:1})):V("",!0),l.filter_condition.show_remark?(s(),d(k,{key:4,label:"Remark"},{default:o(()=>[a(D,{modelValue:l.filter_condition.remark_str,"onUpdate:modelValue":t[13]||(t[13]=i=>l.filter_condition.remark_str=i),style:{width:"200px","font-size":"24px","margin-right":"20px"},clearable:""},null,8,["modelValue"]),a(u,{modelValue:l.filter_condition.remark_any,"onUpdate:modelValue":t[14]||(t[14]=i=>l.filter_condition.remark_any=i),onChange:n.checkNoTag,style:{"margin-left":"10px","font-size":"24px"},size:"large",border:""},{default:o(()=>[_(" Any Remark ")]),_:1},8,["modelValue","onChange"])]),_:1})):V("",!0),l.filter_condition.show_sort?(s(),d(k,{key:5,label:"Sort"},{default:o(()=>[a(F,{modelValue:l.filter_condition.show_sort_id,"onUpdate:modelValue":t[15]||(t[15]=i=>l.filter_condition.show_sort_id=i)},{default:o(()=>[(s(!0),A(v,null,x(n.sort_option_list,i=>(s(),d(b,{label:i.label,value:i.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):V("",!0)]),_:1},8,["model"])]),_:1})}const xt=U(Vt,[["render",At]]),vt={name:"ActorTagChooser",props:{actor:at},emits:["submit","cancel"],components:{NewActorTag:Y},data(){return{search_text:"",editing_tags:[]}},computed:{...L(E,{actor_tag_list:"sorted_list"})},mounted(){console.log(`mounted ActorTagChooser for [${this.actor.actor_name}]`),this.initTags()},methods:{onSearchTextChange(){console.log("onSearchTextChange",this.search_text)},searchClass(e){return this.search_text==""?"normal-text":e.tag.tag_name.includes(this.search_text)?"filtered-text":"failed-text"},initTags(){this.editing_tags=[];for(let e=0;e<10;e++)this.editing_tags.push([]);for(const e of this.actor_tag_list){const t=Math.floor(e.tag_priority/100),l=this.actor.hasTag(e.tag_id);this.editing_tags[t].push({tag:e,selected:l})}this.editing_tags.reverse()},onSubmit(){let e=[];for(const t of this.editing_tags)for(const l of t)l.selected&&e.push(l.tag.tag_id);this.editing_tags=[],this.$emit("submit",e)},onCancel(){this.$emit("cancel")}}};function St(e,t,l,w,c,n){const u=r("NewActorTag"),h=r("el-input"),y=r("el-checkbox-button"),p=r("el-space"),f=r("el-button"),C=r("el-container");return s(),d(C,null,{default:o(()=>[a(p,{direction:"vertical",size:"large",fill:!0},{default:o(()=>[a(u,{onTag_added:n.initTags},null,8,["onTag_added"]),a(h,{modelValue:c.search_text,"onUpdate:modelValue":t[0]||(t[0]=S=>c.search_text=S),onInput:n.onSearchTextChange,placeholder:"Search tags",clearable:""},null,8,["modelValue","onInput"]),(s(!0),A(v,null,x(c.editing_tags,S=>(s(),d(p,{style:{border:"1px solid","border-radius":"4px",padding:"2px"},direction:"horizontal",wrap:!0,size:3,alignment:"stretch"},{default:o(()=>[(s(!0),A(v,null,x(S,k=>(s(),d(y,{modelValue:k.selected,"onUpdate:modelValue":b=>k.selected=b,class:G(n.searchClass(k))},{default:o(()=>[_(z(k.tag.tag_name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","class"]))),256))]),_:2},1024))),256)),a(p,{direction:"horizontal",alignment:"center"},{default:o(()=>[a(f,{type:"primary",onClick:n.onSubmit},{default:o(()=>[_(" Save ")]),_:1},8,["onClick"]),a(f,{type:"warning",onClick:n.onCancel},{default:o(()=>[_(" Cancel ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const zt=U(vt,[["render",St],["__scopeId","data-v-9d65b63a"]]),Ft={name:"RemarkEditor",props:{remark:{type:String,required:!0}},data(){return{remark_items:[]}},methods:{onClear(e){this.remark_items.splice(e,1)},onAddRemark(){this.remark_items.push({data:""})},onSubmit(){if(this.remark_items.length==0){this.$emit("submit","");return}const e=this.remark_items.map(t=>t.data).join(`
`);this.$emit("submit",e)},onCancel(){this.$emit("cancel")}},mounted(){if(this.remark_items=[],this.remark!=null&&this.remark!=""){let e=this.remark.split(`
`);for(let t=0;t<e.length;t++)this.remark_items.push({data:e[t]})}}};function Tt(e,t,l,w,c,n){const u=r("el-text"),h=r("svg-icon"),y=r("el-space"),p=r("el-input"),f=r("el-button");return s(),d(y,{direction:"vertical",fill:!0},{default:o(()=>[a(y,{direction:"horizontal"},{default:o(()=>[a(u,{style:{"font-size":"24px",color:"hotpink"}},{default:o(()=>[_(" Remarks ")]),_:1}),a(h,{size:"24px",name:"add",onClick:n.onAddRemark},null,8,["onClick"])]),_:1}),(s(!0),A(v,null,x(c.remark_items,(C,S)=>(s(),d(y,{direction:"horizontal",alignment:"center"},{default:o(()=>[a(p,{modelValue:C.data,"onUpdate:modelValue":k=>C.data=k,style:{width:"500px"}},null,8,["modelValue","onUpdate:modelValue"]),a(h,{name:"remove",size:"24px",onClick:k=>n.onClear(S)},null,8,["onClick"])]),_:2},1024))),256)),a(y,{direction:"horizontal",alignment:"stretch"},{default:o(()=>[a(f,{type:"primary",onClick:n.onSubmit},{default:o(()=>[_(" Save ")]),_:1},8,["onClick"]),a(f,{type:"warning",onClick:n.onCancel},{default:o(()=>[_(" Cancel ")]),_:1},8,["onClick"])]),_:1})]),_:1})}const et=U(Ft,[["render",Tt]]);class J{get is_editing(){return this._is_editing}set is_editing(t){if(this._is_editing!=t){if(t)this.actor_name=this.fixed_actor_name||"";else if(this.post_id_prefix.length<this.calcMinPrefixLength())return;this._is_editing=t}}get has_actor_name(){return this.actor_name!=""}calcMinPrefixLength(){return this.has_comment?0:this.actor_name.length>0?3:5}constructor(t){this.fixed_actor_name=t,this.actor_name=t||"",this.post_id_prefix="",this.has_comment=!1,this._is_editing=!0}}class Pt{}class Ut extends ft{}const W="http://127.0.0.1:8000/api/post";async function Dt(e){const t=`${W}/actor_list`;return await O(t,e)}async function Nt(e){const t=`${W}/post_list`,[l,w]=await O(t,e);if(!l)return[l,w];const c=[];for(const n of w){const u=new Ut(n);c.push(u)}return[!0,c]}async function Lt(e,t){const l=`${W}/set_comment`,w=new Pt;return w.post_id=e,w.comment=t,await O(l,w)}const Rt={name:"Posts",props:{specific_actor_name:{type:String,required:!1}},data(){return{conditionForm:J,actor_post_list:[],post_list:[]}},methods:{startEdit(){this.conditionForm.is_editing=!0,this.actor_post_list=[],this.post_list=[]},endEdit(){if(this.conditionForm.is_editing=!1,this.conditionForm.is_editing){let e=this.conditionForm.calcMinPrefixLength();q(`prefix of post id should be at least ${e} bits`);return}this.conditionForm.actor_name!==""?this.getActorPosts():this.getActorNames()},async getActorNames(){const[e,t]=await Dt(this.conditionForm);e&&(this.actor_post_list=t,this.post_list=[])},async getActorPosts(){const[e,t]=await Nt(this.conditionForm);e&&(this.post_list=t)},async onPostEdit(e){if(e.is_editing){const[t,l]=await Lt(e.post_id,e.comment);t&&(e.is_editing=!1)}else e.is_editing=!0}},mounted(){console.log(`posts of ${this.specific_actor_name}`),this.conditionForm=new J(this.specific_actor_name)}};function It(e,t,l,w,c,n){const u=r("el-input"),h=r("el-checkbox"),y=r("el-button"),p=r("el-space"),f=r("el-divider"),C=r("el-badge"),S=r("el-radio"),k=r("el-radio-group"),b=r("el-text"),F=r("svg-icon");return s(),d(p,{direction:"vertical",fill:!0,style:{"padding-bottom":"5px"}},{default:o(()=>[a(p,{direction:"horizontal",size:"small"},{default:o(()=>[c.conditionForm.has_actor_name?(s(),d(u,{key:0,disabled:""},{default:o(()=>[_(z(c.conditionForm.actor_name),1)]),_:1})):V("",!0),a(u,{modelValue:c.conditionForm.post_id_prefix,"onUpdate:modelValue":t[0]||(t[0]=g=>c.conditionForm.post_id_prefix=g),placeholder:"Post Id Prefix",clearable:"",disabled:!c.conditionForm.is_editing,style:{width:"150px"}},null,8,["modelValue","disabled"]),a(h,{modelValue:c.conditionForm.has_comment,"onUpdate:modelValue":t[1]||(t[1]=g=>c.conditionForm.has_comment=g),disabled:!c.conditionForm.is_editing,style:{"font-size":"20px"},size:"default",border:""},{default:o(()=>[_(" Has Comment ")]),_:1},8,["modelValue","disabled"]),c.conditionForm.is_editing?V("",!0):(s(),d(y,{key:1,type:"success",onClick:n.startEdit},{default:o(()=>[_("Edit")]),_:1},8,["onClick"])),c.conditionForm.is_editing?(s(),d(y,{key:2,type:"primary",onClick:n.endEdit},{default:o(()=>[_("Save")]),_:1},8,["onClick"])):V("",!0)]),_:1}),l.specific_actor_name?V("",!0):(s(),d(f,{key:0,style:{margin:"5px 0"}})),l.specific_actor_name?V("",!0):(s(),d(p,{key:1,direction:"horizontal",wrap:""},{default:o(()=>[a(k,{modelValue:c.conditionForm.actor_name,"onUpdate:modelValue":t[2]||(t[2]=g=>c.conditionForm.actor_name=g),onChange:n.getActorPosts},{default:o(()=>[(s(!0),A(v,null,x(c.actor_post_list,g=>(s(),d(S,{value:g.actor_name},{default:o(()=>[_(z(g.actor_name)+" ",1),a(C,{class:"mark",value:g.post_count},null,8,["value"])]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue","onChange"])]),_:1})),a(f,{style:{margin:"5px 0"}}),(s(!0),A(v,null,x(c.post_list,g=>(s(),d(p,{direction:"horizontal"},{default:o(()=>[a(b,{style:{"font-size":"22px",color:"royalblue"}},{default:o(()=>[_(z(g.post_id),1)]),_:2},1024),a(F,{onClick:T=>n.onPostEdit(g),size:"24px",name:g.is_editing?"check":"edit"},null,8,["onClick","name"]),g.is_editing?(s(),d(u,{key:0,modelValue:g.comment,"onUpdate:modelValue":T=>g.comment=T,placeholder:"add comment for post",clearable:"",style:{width:"300px","font-size":"20px"}},null,8,["modelValue","onUpdate:modelValue"])):V("",!0),g.is_editing?V("",!0):(s(),d(b,{key:1,style:{"font-size":"20px"}},{default:o(()=>[_(z(g.comment),1)]),_:2},1024))]),_:2},1024))),256))]),_:1})}const ot=U(Rt,[["render",It]]);let Et=0;class X{constructor(t){this.data=t}set data(t){this.uuid=++Et,this.actor=t}get data(){return this.actor}get id(){return this.uuid}}function B(e){const t=[];for(const l of e)t.push(new X(l));return t}const Gt={name:"ActorCard",components:{ActorTagChooser:zt,SvgIcon:Z,RemarkEditor:et,Posts:ot},props:{actor_data:X},computed:{...L(R,{group_list:"sorted_list"}),actor(){return this.actor_data.data},star_colors(){return tt},group_color(){return this.getActorGroup(this.actor_data.data.actor_category).group_color}},emits:["refresh","link","download","post"],data(){return{is_editing_tags:!1,editing_tags:[],is_show_post:!1}},mounted(){this.actor.sortTags(this.compareActorTagId),this.getFileInfo()},methods:{...P(E,{compareActorTagId:"compareTagId",getTagStyleName:"getStyleName",getTagName:"getName"}),...P(R,{getActorGroup:"get"}),getActorGroupData(){let e=this.actor_data.data.actor_category;return this.getActorGroup(e)},hasFolder(){return this.getActorGroupData().has_folder},onRecvActorMsg(e,t,l){e&&(this.actor_data.data=t,this.actor.sortTags(this.compareActorTagId),this.$emit("refresh",this.actor_data),H(l),this.getFileInfo())},gotoActorPage(){window.open(this.actor.href,"_blank","noreferrer")},openFolder(){nt(this.actor.actor_name)},async setActorCategory(){if(this.actor.rel_tags.length==0){q("add any tag before setting category");return}const[e,t]=await lt(this.actor.actor_name,this.actor.actor_category);this.onRecvActorMsg(e,t,"change category succeed")},onStartEditTag(){this.is_editing_tags=!0},async onSubmitTag(e){this.is_editing_tags=!1;const[t,l]=await rt(this.actor.actor_name,e);this.onRecvActorMsg(t,l,"change tags succeed")},async onCancelAddTag(){this.is_editing_tags=!1,this.editing_tags=[]},toDownload(){this.$emit("download",this.actor_data)},showPosts(){this.is_show_post=!0},async changeScore(){const[e,t]=await it(this.actor.actor_name,this.actor.score);this.onRecvActorMsg(e,t,"change score succeed")},async findLinkedActor(){this.$emit("link",this.actor_data)},async onSubmitRemark(e){if(e==this.actor.remark)return;const[t,l]=await Q(this.actor.actor_name,e);this.onRecvActorMsg(t,l,"change remark succeed")},async getFileInfo(){const[e,t]=await st(this.actor.actor_name);e&&(this.actor.res_info=t.res_info,this.actor.total_post_count=t.total_post_count,this.actor.unfinished_post_count=t.unfinished_post_count,this.actor.finished_post_count=t.finished_post_count)}}};const Mt={class:"avatar"};function Bt(e,t,l,w,c,n){const u=r("el-image"),h=r("svg-icon"),y=r("el-rate"),p=r("el-text"),f=r("el-button"),C=r("el-space"),S=r("el-popover"),k=r("RemarkEditor"),b=r("el-option"),F=r("el-select"),g=r("ActorTagChooser"),T=r("el-dialog"),D=r("el-tag"),N=r("Posts");return s(),d(C,{direction:"vertical",class:"actor_card",alignment:"stretch",size:"default",key:n.actor.uuid,style:I({color:n.group_color})},{default:o(()=>[$("div",Mt,[a(u,{class:"avatar-img",src:n.actor.icon},null,8,["src"]),n.actor.main_actor?(s(),d(h,{key:0,class:"avatar-friend",size:"30px",name:"friend",onClick:n.findLinkedActor},null,8,["onClick"])):V("",!0),a(y,{class:"avatar-rate",modelValue:n.actor.show_score,"onUpdate:modelValue":t[0]||(t[0]=i=>n.actor.show_score=i),colors:n.star_colors,"void-color":"#777777",size:"large",onChange:n.changeScore,"allow-half":""},null,8,["modelValue","colors","onChange"])]),a(S,{trigger:"click",placement:"top",width:"240px"},{reference:o(()=>[a(p,{class:"actor_name",style:I({color:n.group_color})},{default:o(()=>[_(z(n.actor.actor_name),1)]),_:1},8,["style"])]),default:o(()=>[a(C,{direction:"vertical"},{default:o(()=>[a(C,{direction:"horizontal"},{default:o(()=>[a(f,{class:"pop-button",onClick:n.gotoActorPage},{default:o(()=>[_(" Go To Page ")]),_:1},8,["onClick"]),a(f,{class:"pop-button",onClick:n.showPosts},{default:o(()=>[_(" Show Posts ")]),_:1},8,["onClick"])]),_:1}),n.hasFolder()?(s(),d(C,{key:0,direction:"horizontal"},{default:o(()=>[a(f,{class:"pop-button",onClick:n.openFolder},{default:o(()=>[_(" Open Folder ")]),_:1},8,["onClick"]),a(f,{class:"pop-button",onClick:n.toDownload},{default:o(()=>[_(" Download ")]),_:1},8,["onClick"])]),_:1})):V("",!0)]),_:1})]),_:1}),a(p,{style:{"font-size":"18px",color:"black"},tag:"ins"},{default:o(()=>[_(z(n.actor.post_desc),1)]),_:1}),(s(!0),A(v,null,x(n.actor.res_info,i=>(s(),d(p,{class:G("res"+i.res_state),style:{"font-size":"14px"}},{default:o(()=>[_(z(n.actor.formatResFileInfo(i)),1)]),_:2},1032,["class"]))),256)),a(C,{direction:"horizontal",alignment:"stretch"},{default:o(()=>[a(S,{placement:"right",trigger:"click",width:600},{reference:o(()=>[a(h,{size:"24px",name:n.actor.remark?"remark":"remark_empty"},null,8,["name"])]),default:o(()=>[a(k,{remark:n.actor.remark,onSubmit:n.onSubmitRemark},null,8,["remark","onSubmit"])]),_:1}),a(F,{modelValue:n.actor.actor_category,"onUpdate:modelValue":t[1]||(t[1]=i=>n.actor.actor_category=i),onChange:n.setActorCategory,style:{width:"140px"}},{default:o(()=>[(s(!0),A(v,null,x(e.group_list,i=>(s(),d(b,{label:i.group_name,value:i.group_id,style:I({color:i.group_color})},{default:o(()=>[_(z(i.show_content),1)]),_:2},1032,["label","value","style"]))),256))]),_:1},8,["modelValue","onChange"]),a(h,{onClick:t[2]||(t[2]=i=>n.onStartEditTag()),size:"24px",name:"edit"})]),_:1}),a(T,{modelValue:c.is_editing_tags,"onUpdate:modelValue":t[3]||(t[3]=i=>c.is_editing_tags=i),title:n.actor.actor_name,width:"67%"},{default:o(()=>[a(g,{actor:n.actor,onSubmit:n.onSubmitTag,onCancel:n.onCancelAddTag},null,8,["actor","onSubmit","onCancel"])]),_:1},8,["modelValue","title"]),a(C,{wrap:"",style:{"margin-top":"5px"}},{default:o(()=>[(s(!0),A(v,null,x(n.actor.rel_tags,i=>(s(),d(D,{class:G(e.getTagStyleName(i)),style:{"font-size":"18px"},round:""},{default:o(()=>[_(z(e.getTagName(i)),1)]),_:2},1032,["class"]))),256))]),_:1}),a(T,{modelValue:c.is_show_post,"onUpdate:modelValue":t[4]||(t[4]=i=>c.is_show_post=i),title:"Posts",width:"720px"},{default:o(()=>[a(N,{specific_actor_name:n.actor.actor_name},null,8,["specific_actor_name"])]),_:1},8,["modelValue"])]),_:1},8,["style"])}const jt=U(Gt,[["render",Bt],["__scopeId","data-v-e902c362"]]),K=pt("ActorFilterStore",{state:()=>({filter:null}),getters:{filter_condition:e=>(e.filter===null&&(e.filter=new j),e.filter)},actions:{setFilterCondition(e){this.filter=e.clone()}}}),Ot={name:"ActorLine",components:{SvgIcon:Z,RemarkEditor:et},props:{actor_data:X},computed:{actor(){return this.actor_data.data},star_colors(){return tt}},methods:{...P(R,{getActorGroup:"get"}),...P(E,{compareActorTagId:"compareTagId",getTagStyleName:"getStyleName",getTagName:"getName"}),getGroupColor(e){return this.getActorGroup(e).group_color},async onSubmitRemark(e){if(e==this.actor.remark)return;const[t,l]=await Q(this.actor.actor_name,e);t&&(this.actor_data.data=l,H("change remark succeed"))}},mounted(){this.actor.sortTags(this.compareActorTagId)}};const qt={style:{position:"relative",margin:"10px",height:"100px",width:"100px"}};function Ht(e,t,l,w,c,n){const u=r("el-image"),h=r("el-rate"),y=r("el-text"),p=r("el-tag"),f=r("el-space"),C=r("svg-icon"),S=r("RemarkEditor"),k=r("el-popover");return s(),d(f,{direction:"horizontal",size:"large",class:"actor_line",alignment:"center",key:n.actor.uuid,shadow:"always",style:I({color:n.getGroupColor(n.actor.actor_category)})},{default:o(()=>[$("div",qt,[a(u,{src:n.actor.icon},null,8,["src"]),a(h,{modelValue:n.actor.show_score,"onUpdate:modelValue":t[0]||(t[0]=b=>n.actor.show_score=b),colors:n.star_colors,"void-color":"#777777",size:"small",style:{position:"absolute",bottom:"0",left:"50%",transform:"translateX(-50%)"},"allow-half":"",disabled:""},null,8,["modelValue","colors"])]),a(f,{direction:"vertical",alignment:"start",size:"small"},{default:o(()=>[a(y,{class:"actor_name"},{default:o(()=>[_(z(n.actor.actor_name),1)]),_:1}),a(f,{direction:"horizontal",wrap:""},{default:o(()=>[(s(!0),A(v,null,x(n.actor.rel_tags,b=>(s(),d(p,{class:G(e.getTagStyleName(b)),style:{"font-size":"18px"},round:""},{default:o(()=>[_(z(e.getTagName(b)),1)]),_:2},1032,["class"]))),256))]),_:1}),a(f,{direction:"horizontal",alignment:"start"},{default:o(()=>[a(k,{placement:"right",trigger:"click",width:600},{reference:o(()=>[a(C,{size:"24px",name:n.actor.remark?"remark":"remark_empty"},null,8,["name"])]),default:o(()=>[a(S,{remark:n.actor.remark,onSubmit:n.onSubmitRemark},null,8,["remark","onSubmit"])]),_:1}),a(f,{direction:"vertical",alignment:"start"},{default:o(()=>[(s(!0),A(v,null,x(n.actor.remark_list,b=>(s(),d(y,{onClick:t[1]||(t[1]=()=>{})},{default:o(()=>[_(z(b),1)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])}const Wt=U(Ot,[["render",Ht],["__scopeId","data-v-b052e20f"]]),Xt={components:{Posts:ot,ActorLine:Wt,ActorCard:jt,ActorFilter:xt,draggable:ht,DownloadLimit:ct},data(){return{filter_condition:new j,actor_list:[],actor_size:10,cur_actor_page:1,actor_count:0,active_parts:["filter"],linked_list:[],download_actor_names:[],download_limit:null,actor_show_type:M.Card,is_show_post:!1}},computed:{...L(K,{cached_filter_condition:"filter_condition"}),...L(R,{group_list:"sorted_list"}),is_show_download(){return this.download_actor_names.length>0},download_title(){switch(this.download_actor_names.length){case 0:return"";case 1:return this.download_actor_names[0];default:{let t=this.download_actor_names.join(",");return t.length>30&&(t=t.substring(0,30),t+="..."),t}}},actor_show_options(){return wt},actor_show_card(){return this.actor_show_type==M.Card},actor_show_line(){return this.actor_show_type==M.Line}},methods:{...P(E,{getTagsFromServer:"getFromServer"}),...P(K,{saveFilterCondition:"setFilterCondition"}),...P(R,{getGroupsFromServer:"getFromServer"}),async handleSizeChange(e){this.actor_size=e,this.cur_actor_page=1,await this.onActorPageChange()},async onActorPageChange(){const[e,t]=await _t(this.filter_condition,this.actor_size,(this.cur_actor_page-1)*this.actor_size);e?this.actor_list=B(t):this.actor_list=[]},async onFilterChange(){this.saveFilterCondition(this.filter_condition),this.actor_list=[],this.actor_count=0;const[e,t]=await dt(this.filter_condition);e&&(this.actor_count=t),this.cur_actor_page=1,await this.onActorPageChange()},onActorChange(e){console.log(`actor changed: ${e.data.actor_name}`)},async onActorLinkClick(e){console.log(`actor link clicked: ${e.data.actor_name}`);const[t,l]=await ut(e.data.actor_name);t?this.actor_list=B(l):this.actor_list=[]},async linkActors(){if(this.linked_list.length<2){q("No actor to link");return}const e=this.linked_list.map(w=>w.data.actor_name),[t,l]=await mt(e);if(t)for(const w of this.linked_list)w.data.actor_name in l&&(w.data=l[w.data.actor_name]);else this.linked_list=[]},clearLinkedActors(){this.linked_list=[]},showDownloadLimit(e){this.download_actor_names=e,this.download_limit==null&&(this.download_limit=new yt,this.download_limit.resetDefaultValue(bt.Current_Init))},singleShowDownload(e){this.showDownloadLimit([e.data.actor_name])},batchShowDownload(){let e=this.actor_list.map(t=>t.data.actor_name);this.showDownloadLimit(e)},async onSubmitDownload(){let[e,t]=await Ct(this.download_limit,this.download_actor_names);this.onDownloadClose(),e&&H("download started")},onDownloadClose(){this.download_actor_names=[]},async batchSetActorCategory(e){let t=this.actor_list.map(c=>c.data.actor_name),[l,w]=await gt(t,e);l?this.actor_list=B(w):this.actor_list=[]},showPosts(){this.is_show_post=!0}},watch:{},async mounted(){this.filter_condition=this.cached_filter_condition,await this.getTagsFromServer(),await this.getGroupsFromServer()}};function Jt(e,t,l,w,c,n){const u=r("el-button"),h=r("el-space"),y=r("ActorCard"),p=r("draggable"),f=r("el-collapse-item"),C=r("ActorFilter"),S=r("el-collapse"),k=r("el-pagination"),b=r("el-option"),F=r("el-select"),g=r("el-popover"),T=r("ActorLine"),D=r("DownloadLimit"),N=r("el-dialog"),i=r("Posts");return s(),d(h,{direction:"vertical",fill:!0},{default:o(()=>[a(S,{modelValue:c.active_parts,"onUpdate:modelValue":t[1]||(t[1]=m=>c.active_parts=m)},{default:o(()=>[a(f,{name:"link",title:"Linked Actors"},{default:o(()=>[a(h,{direction:"horizontal"},{default:o(()=>[a(h,{direction:"vertical",alignment:"stretch"},{default:o(()=>[a(u,{type:"primary",onClick:n.linkActors},{default:o(()=>[_("Link")]),_:1},8,["onClick"]),a(u,{type:"danger",onClick:n.clearLinkedActors},{default:o(()=>[_("Clear")]),_:1},8,["onClick"])]),_:1}),a(p,{modelValue:c.linked_list,"onUpdate:modelValue":t[0]||(t[0]=m=>c.linked_list=m),group:{name:"actors",pull:!1,put:!0},class:"card_row"},{default:o(()=>[(s(!0),A(v,null,x(c.linked_list,m=>(s(),d(y,{actor_data:m,key:m.data.actor_name,class:"card"},null,8,["actor_data"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(f,{name:"filter",title:"Actor Filter"},{default:o(()=>[a(h,{direction:"vertical"},{default:o(()=>[a(C,{filter_condition:c.filter_condition,onChange:n.onFilterChange},null,8,["filter_condition","onChange"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(h,{direction:"horizontal",size:"large",spacer:"|"},{default:o(()=>[a(k,{"current-page":c.cur_actor_page,"onUpdate:currentPage":t[2]||(t[2]=m=>c.cur_actor_page=m),"page-size":c.actor_size,"page-sizes":[10,14],total:c.actor_count,onCurrentChange:n.onActorPageChange,onSizeChange:n.handleSizeChange,layout:"sizes, total, prev, pager, next",background:"",style:{margin:"5px"}},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"]),a(g,{trigger:"click",placement:"right",width:"200px"},{reference:o(()=>[a(u,null,{default:o(()=>[_("Operate These Actors")]),_:1})]),default:o(()=>[a(h,{direction:"vertical",style:{width:"180px"},fill:!0},{default:o(()=>[a(u,{onClick:n.batchShowDownload},{default:o(()=>[_(" Batch Download ")]),_:1},8,["onClick"]),a(F,{placeholder:"Batch Set Category",onChange:n.batchSetActorCategory},{default:o(()=>[(s(!0),A(v,null,x(e.group_list,m=>(s(),d(b,{label:m.show_content,value:m.group_id,style:I({color:m.group_color})},null,8,["label","value","style"]))),256))]),_:1},8,["onChange"])]),_:1})]),_:1}),a(F,{modelValue:c.actor_show_type,"onUpdate:modelValue":t[3]||(t[3]=m=>c.actor_show_type=m),style:{"min-width":"100px"}},{default:o(()=>[(s(!0),A(v,null,x(n.actor_show_options,m=>(s(),d(b,{label:m.label,value:m.value},null,8,["label","value"]))),256))]),_:1},8,["modelValue"]),a(u,{type:"primary",onClick:n.showPosts},{default:o(()=>[_(" Posts ")]),_:1},8,["onClick"])]),_:1}),n.actor_show_card?(s(),d(p,{key:0,modelValue:c.actor_list,"onUpdate:modelValue":t[4]||(t[4]=m=>c.actor_list=m),group:{name:"actors",pull:"clone",put:!1},class:"card_row"},{default:o(()=>[(s(!0),A(v,null,x(c.actor_list,m=>(s(),d(y,{actor_data:m,key:m.id,onRefresh:n.onActorChange,onLink:n.onActorLinkClick,onDownload:n.singleShowDownload,onPost:e.showActorPosts,class:"card"},null,8,["actor_data","onRefresh","onLink","onDownload","onPost"]))),128))]),_:1},8,["modelValue"])):V("",!0),n.actor_show_line?(s(),d(h,{key:1,direction:"vertical",size:"small",fill:!0},{default:o(()=>[(s(!0),A(v,null,x(c.actor_list,m=>(s(),d(T,{actor_data:m,key:m.id},null,8,["actor_data"]))),128))]),_:1})):V("",!0),a(N,{modelValue:n.is_show_download,"onUpdate:modelValue":t[5]||(t[5]=m=>n.is_show_download=m),title:n.download_title,"before-close":n.onDownloadClose,width:"640px"},{default:o(()=>[a(h,{direction:"vertical"},{default:o(()=>[a(D,{download_limit:c.download_limit},null,8,["download_limit"]),a(h,{direction:"horizontal",alignment:"center"},{default:o(()=>[a(u,{type:"primary",onClick:n.onSubmitDownload},{default:o(()=>[_(" Download ")]),_:1},8,["onClick"]),a(u,{type:"warning",onClick:n.onDownloadClose},{default:o(()=>[_(" Cancel ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","title","before-close"]),a(N,{modelValue:c.is_show_post,"onUpdate:modelValue":t[6]||(t[6]=m=>c.is_show_post=m),title:"Posts",width:"720px"},{default:o(()=>[a(i)]),_:1},8,["modelValue"])]),_:1})}const ee=U(Xt,[["render",Jt],["__scopeId","data-v-b9fa2703"]]);export{ee as default};
